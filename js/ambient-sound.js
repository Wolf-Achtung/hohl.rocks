/* ambient-sound.js â€” Radiohead-leaning Ambient (toggle only) */(function(){let c,m,r=false;function g(t,o,d=2){const n=c.currentTime;t.cancelScheduledValues(n);t.setValueAtTime(t.value,n);t.linearRampToValueAtTime(o,n+d);}function nt(f,d,l=0.06){const o=c.createOscillator();o.type='triangle';o.frequency.value=f;const g1=c.createGain();g1.gain.value=0;o.connect(g1).connect(m);const lfo=c.createOscillator(),lg=c.createGain();lfo.frequency.value=0.09;lg.gain.value=f*0.0075;lfo.connect(lg).connect(o.frequency);o.start();lfo.start();g(g1.gain,l,1.8);setTimeout(()=>{g(g1.gain,0,2);setTimeout(()=>{o.stop();lfo.stop();g1.disconnect();},2100);},d*1000);}function nz(d=7,l=0.02){const b=c.createBuffer(1,c.sampleRate*d,c.sampleRate),a=b.getChannelData(0);for(let i=0;i<a.length;i++)a[i]=(Math.random()*2-1)*0.45;const s=c.createBufferSource();s.buffer=b;const f=c.createBiquadFilter();f.type='lowpass';f.frequency.value=1100;const g1=c.createGain();g1.gain.value=l;s.connect(f).connect(g1).connect(m);s.start();setTimeout(()=>{g1.gain.linearRampToValueAtTime(0,c.currentTime+2);setTimeout(()=>s.stop(),2100);},d*1000);}function tick(){if(!r)return;const base=196,scale=[0,3,5,7,10];const v=2+Math.floor(Math.random()*2);for(let i=0;i<v;i++){const semi=scale[(Math.random()*scale.length)|0];nt(base*Math.pow(2,semi/12),7+Math.random()*6,0.05+Math.random()*0.03);}if(Math.random()<0.7)nz(5+Math.random()*4,0.015+Math.random()*0.02);setTimeout(tick,3600+Math.random()*1600);}function build(){c=c||new (window.AudioContext||window.webkitAudioContext)();m=c.createGain();m.gain.value=0;m.connect(c.destination);}function start(){if(!c)build();if(!r){r=true;g(m.gain,0.6,3);tick();}}function stop(){if(!c)return;r=false;g(m.gain,0,2);}function toggle(){(!c||!r)?start():stop();}document.addEventListener('DOMContentLoaded',()=>{const d=document.getElementById('ambient');if(!d)return;d.addEventListener('click',e=>{const b=e.target.closest('button');if(!b)return;if(b.dataset.act==='toggle'){toggle();b.classList.toggle('on');}});const first=()=>{document.removeEventListener('pointerdown',first);};document.addEventListener('pointerdown',first);});window.Ambient={start,stop,toggle};})();